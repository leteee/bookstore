<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>è´­ç‰©è½¦</title>
    <link type="text/css" rel="stylesheet" href="/static/css/style.css">
    <script type="text/javascript" src="/static/script/jquery-1.7.2.js"></script>
    <script type="text/javascript">
        $(function () {
            $("#emptyCart").click(function () {
                return confirm("äº²ï¼ç¡®å®šè¦æ¸…ç©ºè´­ç‰©è½¦å—ï¼ŸğŸ¥¹")
            })
            $("#deleteCartItem").click(function () {
                const bookTitle = $(this).attr('id');
                return confirm("ç¡®å®šè¦åˆ é™¤" + bookTitle + "è¿™æœ¬å›¾ä¹¦å—ï¼Ÿ")
            })
            $(".updateCartItem").change(function () {
                const cartItemId = $(this).attr('id')
                const bookCount = $(this).val()
                // location = "/updateCartItem?cartItemId=" + cartItemId + "&bookCount=" + bookCount;
                var url = "/updateCartItem"
                var param = {
                    "cartItemId": cartItemId,
                    "bookCount": bookCount
                }
                var tdElm = $(this).parent().next().next()
                $.post(url, param, function (res) {
                    $("#totalCount").text(res.totalCount)
                    $("#totalAmount").text(res.totalAmount)
                    tdElm.text(res.amount)
                }, 'json')
            })
        })
    </script>
</head>
<body>

<div id="header">
    <img class="logo_img" alt="" src="/static/img/logo.gif">
    <span class="wel_word">è´­ç‰©è½¦</span>
    {{if .UserID}}
    <div>
        <span>æ¬¢è¿<span class="um_span">{{.Username}}</span>å…‰ä¸´å°šç¡…è°·ä¹¦åŸ</span>
        <a href="/getCartInfo">è´­ç‰©è½¦</a>
        <a href="/logout">æ³¨é”€</a>&nbsp;&nbsp;
        <a href="/">è¿”å›</a>
    </div>
    {{else}}
    <div>
        <a href="/pages/user/login.html">ç™»å½•</a> |
        <a href="/pages/user/regist.html">æ³¨å†Œ</a> &nbsp;&nbsp;
        <a href="/getCartInfo">è´­ç‰©è½¦</a>
        <a href="/pages/manager/manager.html">åå°ç®¡ç†</a>
    </div>
    {{end}}
</div>

<div id="main">
    {{if .Cart}}
    <table>
        <tr>
            <td>å•†å“åç§°</td>
            <td>æ•°é‡</td>
            <td>å•ä»·</td>
            <td>é‡‘é¢</td>
            <td>æ“ä½œ</td>
        </tr>
        {{range .Cart.CartItems}}
        <tr>
            <td>{{.Book.Title}}</td>
            <td>
                <input id="{{.CartItemID}}" class="updateCartItem" value="{{.Count}}"
                       style="text-align: center;width: 50px">
            </td>
            <td>{{.Book.Price}}</td>
            <td>{{.Amount}}</td>
            <td><a class="deleteCartItem" id="{{.Book.Title}}" href="deleteCartItem?cartItemId={{.CartItemID}}">åˆ é™¤</a>
            </td>
        </tr>
        {{end}}
    </table>
    <div class="cart_info">
        <span class="cart_span">è´­ç‰©è½¦ä¸­å…±æœ‰<span class="b_count"
                                                  id="totalCount">{{.Cart.TotalCount}}</span>ä»¶å•†å“</span>
        <span class="cart_span">æ€»é‡‘é¢<span class="b_price" id="totalAmount">{{.Cart.TotalAmount}}</span>å…ƒ</span>
        <span class="cart_span"><a href="/">ç»§ç»­è´­ç‰©</a></span>
        <span class="cart_span"><a href="/emptyCart" id="emptyCart">æ¸…ç©ºè´­ç‰©è½¦</a></span>
        <span class="cart_span"><a href="/checkout">å»ç»“è´¦</a></span>
    </div>
    {{else}}
    <h1 style="text-align: center">æ‚¨çš„è´­ç‰©è½¦å·²ç»é¥¥æ¸´éš¾è€äº†ï¼Œå¿«å»ä¸»é¡µ<a style="color: red" href="/">è´­ç‰©</a>å§ï¼</h1>
    {{end}}
</div>

<div id="bottom">
		<span>
			å°šç¡…è°·ä¹¦åŸ.Copyright &copy;2015
		</span>
</div>
</body>
</html>